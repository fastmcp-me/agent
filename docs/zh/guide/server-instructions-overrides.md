# æœåŠ¡å™¨æŒ‡ä»¤è¦†ç›–

è‡ªå®šä¹‰æ¨¡æ¿æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯èƒ½å¤Ÿä½¿ç”¨ Handlebars é€»è¾‘è¦†ç›–ã€è¿‡æ»¤æˆ–è‡ªå®šä¹‰æœåŠ¡å™¨æŒ‡ä»¤ã€‚è¿™ä½¿æ‚¨å¯ä»¥å®Œå…¨æ§åˆ¶å¦‚ä½•å‘ LLM å‘ˆç°æœåŠ¡å™¨æŒ‡ä»¤ã€‚

## åŸºæœ¬æœåŠ¡å™¨æŒ‡ä»¤è¦†ç›–æ¨¡å¼

### 1. å®Œå…¨æ›¿æ¢æœåŠ¡å™¨æŒ‡ä»¤

æ‚¨å¯ä»¥ç”¨è‡ªå·±çš„è‡ªå®šä¹‰å†…å®¹æ›¿æ¢åŸå§‹æœåŠ¡å™¨æŒ‡ä»¤ï¼š

::: v-pre

```markdown
{{#each servers}}
{{#if hasInstructions}}
<{{name}}>
{{#if (eq name "problematic-server")}}

# {{name}} çš„è‡ªå®šä¹‰æŒ‡ä»¤

æ­¤æœåŠ¡å™¨å·²ä½¿ç”¨ç®€åŒ–æŒ‡ä»¤è¿›è¡Œè‡ªå®šä¹‰ã€‚
ä½¿ç”¨è¿™äº›å·¥å…·ï¼štool1ã€tool2ã€tool3
{{else}}
{{instructions}}
{{/if}}
</{{name}}>
{{/if}}
{{/each}}
```

:::

### 2. è¿‡æ»¤ç‰¹å®šæœåŠ¡å™¨

é€šè¿‡æ·»åŠ æ¡ä»¶å®Œå…¨è·³è¿‡æŸäº›æœåŠ¡å™¨ï¼š

::: v-pre

```markdown
{{#each servers}}
{{#unless (eq name "unwanted-server")}}
{{#if hasInstructions}}
<{{name}}>
{{instructions}}
</{{name}}>
{{/if}}
{{/unless}}
{{/each}}
```

:::

### 3. ä¸ºæœåŠ¡å™¨æŒ‡ä»¤æ·»åŠ å‰ç¼€æˆ–åç¼€

ä½¿ç”¨é™„åŠ ä¸Šä¸‹æ–‡å¢å¼ºæœåŠ¡å™¨æŒ‡ä»¤ï¼š

::: v-pre

```markdown
{{#each servers}}
{{#if hasInstructions}}
<{{name}}>
âš ï¸ **æœåŠ¡å™¨ï¼š{{name}}** - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨

{{instructions}}

ğŸ“ **æ³¨æ„**ï¼šæ‰€æœ‰ {{name}} æ“ä½œéƒ½ä¼šè®°å½•ç”¨äºå®¡è®¡ã€‚
</{{name}}>
{{/if}}
{{/each}}
```

:::

### 4. åŸºäºæœåŠ¡å™¨åç§°çš„æ¡ä»¶æŒ‡ä»¤

æ ¹æ®æœåŠ¡å™¨ç±»å‹æˆ–å‘½åæ¨¡å¼è¿›è¡Œä¸åŒå¤„ç†ï¼š

::: v-pre

```markdown
{{#each servers}}
{{#if hasInstructions}}
<{{name}}>
{{#if (startsWith name "test-")}}

# æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨ï¼š{{name}}

âš ï¸ è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æœåŠ¡å™¨ã€‚ç»“æœå¯èƒ½ä¸å¯é ã€‚

{{instructions}}
{{else if (startsWith name "prod-")}}

# ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ï¼š{{name}}

âœ… è¿™æ˜¯ä¸€ä¸ªç”Ÿäº§æœåŠ¡å™¨ã€‚æ‰€æœ‰æ“ä½œéƒ½å—åˆ°ç›‘æ§ã€‚

{{instructions}}
{{else}}
{{instructions}}
{{/if}}
</{{name}}>
{{/if}}
{{/each}}
```

:::

## é«˜çº§è¦†ç›–æŠ€æœ¯

### 1. æœåŠ¡å™¨æŒ‡ä»¤è½¬æ¢

ä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘è½¬æ¢æŒ‡ä»¤ï¼š

::: v-pre

```markdown
{{#each servers}}
{{#if hasInstructions}}
<{{name}}>
{{#if (eq name "verbose-server")}}

# ç®€åŒ–çš„ {{name}} æŒ‡ä»¤

{{! ç”¨ç®€åŒ–ç‰ˆæœ¬æ›¿æ¢å†—é•¿çš„æŒ‡ä»¤ }}
æ­¤æœåŠ¡å™¨æä¾›æ–‡ä»¶æ“ä½œã€‚ä¸»è¦å·¥å…·ï¼š

- read_fileï¼šè¯»å–æ–‡ä»¶å†…å®¹
- write_fileï¼šå†™å…¥æ–‡ä»¶å†…å®¹
- list_filesï¼šåˆ—å‡ºç›®å½•å†…å®¹
  {{else}}
  {{instructions}}
  {{/if}}
  </{{name}}>
  {{/if}}
  {{/each}}
```

:::

### 2. åˆå¹¶å¤šä¸ªæœåŠ¡å™¨

å°†å¤šä¸ªæœåŠ¡å™¨çš„æŒ‡ä»¤åˆå¹¶åˆ°ç»Ÿä¸€éƒ¨åˆ†ï¼š

::: v-pre

```markdown
## æ–‡ä»¶æ“ä½œ

{{#each servers}}
{{#if (or (eq name "filesystem") (eq name "storage"))}}
{{#if hasInstructions}}

### {{name}} åŠŸèƒ½

{{instructions}}
{{/if}}
{{/if}}
{{/each}}

## æ•°æ®åº“æ“ä½œ

{{#each servers}}
{{#if (or (eq name "database") (eq name "sql"))}}
{{#if hasInstructions}}

### {{name}} åŠŸèƒ½

{{instructions}}
{{/if}}
{{/if}}
{{/each}}

## å…¶ä»–æœåŠ¡

{{#each servers}}
{{#unless (or (eq name "filesystem") (eq name "storage") (eq name "database") (eq name "sql"))}}
{{#if hasInstructions}}
<{{name}}>
{{instructions}}
</{{name}}>
{{/if}}
{{/unless}}
{{/each}}
```

:::

### 3. åŸºäºä¼˜å…ˆçº§çš„æœåŠ¡å™¨æ’åº

æŒ‰é‡è¦æ€§æˆ–åå¥½é‡æ–°æ’åºæœåŠ¡å™¨ï¼š

::: v-pre

```markdown
## é«˜ä¼˜å…ˆçº§æœåŠ¡å™¨

{{#each servers}}
{{#if (or (eq name "critical-server") (eq name "primary-db"))}}
{{#if hasInstructions}}
<{{name}}>
ğŸ”¥ **é«˜ä¼˜å…ˆçº§æœåŠ¡å™¨**

{{instructions}}
</{{name}}>
{{/if}}
{{/if}}
{{/each}}

## æ ‡å‡†æœåŠ¡å™¨

{{#each servers}}
{{#unless (or (eq name "critical-server") (eq name "primary-db"))}}
{{#if hasInstructions}}
<{{name}}>
{{instructions}}
</{{name}}>
{{/if}}
{{/unless}}
{{/each}}
```

:::

## ç”¨äºæœåŠ¡å™¨è¦†ç›–çš„ Handlebars è¾…åŠ©å‡½æ•°

æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›å†…ç½®çš„ Handlebars è¾…åŠ©å‡½æ•°è¿›è¡Œå¤æ‚é€»è¾‘ï¼š

| è¾…åŠ©å‡½æ•°     | æè¿°           | ä½¿ç”¨ç¤ºä¾‹                                                            |
| ------------ | -------------- | ------------------------------------------------------------------- |
| `eq`         | ç›¸ç­‰æ¯”è¾ƒ       | <span v-pre>`{{#if (eq name "server1")}}`</span>                    |
| `ne`         | ä¸ç­‰æ¯”è¾ƒ       | <span v-pre>`{{#if (ne name "server1")}}`</span>                    |
| `or`         | é€»è¾‘æˆ–         | <span v-pre>`{{#if (or (eq name "a") (eq name "b"))}}`</span>       |
| `and`        | é€»è¾‘ä¸         | <span v-pre>`{{#if (and hasInstructions (ne name "skip"))}}`</span> |
| `startsWith` | å­—ç¬¦ä¸²å¼€å¤´åŒ¹é… | <span v-pre>`{{#if (startsWith name "test-")}}`</span>              |
| `endsWith`   | å­—ç¬¦ä¸²ç»“å°¾åŒ¹é… | <span v-pre>`{{#if (endsWith name "-dev")}}`</span>                 |
| `contains`   | å­—ç¬¦ä¸²åŒ…å«     | <span v-pre>`{{#if (contains instructions "deprecated")}}`</span>   |

## å®é™…è¦†ç›–ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç‰¹å®šç¯å¢ƒæŒ‡ä»¤

::: v-pre

```markdown
{{#each servers}}
{{#if hasInstructions}}
<{{name}}>
{{#if (endsWith name "-dev")}}

# å¼€å‘ç¯å¢ƒï¼š{{name}}

âš ï¸ **å¼€å‘æ¨¡å¼**ï¼šæ­¤æœåŠ¡å™¨ä»…ç”¨äºå¼€å‘ã€‚

{{instructions}}

**å¼€å‘æ³¨æ„äº‹é¡¹ï¼š**

- è°ƒè¯•å·²å¯ç”¨
- æ‰€æœ‰æ“ä½œéƒ½ä¼šè¯¦ç»†è®°å½•
- æ•°æ®å¯èƒ½æ¯å¤©é‡ç½®
  {{else if (endsWith name "-prod")}}

# ç”Ÿäº§ç¯å¢ƒï¼š{{name}}

âœ… **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ­¤æœåŠ¡å™¨å¤„ç†å®æ—¶æ•°æ®ã€‚

{{instructions}}

**ç”Ÿäº§å‡†åˆ™ï¼š**

- æ‰€æœ‰æ“ä½œéƒ½ä¼šè¢«å®¡è®¡
- å¼ºåˆ¶æ‰§è¡Œé€Ÿç‡é™åˆ¶
- éµå¾ªå®‰å…¨åè®®
  {{else}}
  {{instructions}}
  {{/if}}
  </{{name}}>
  {{/if}}
  {{/each}}
```

:::

### ç¤ºä¾‹ 2ï¼šæœåŠ¡å™¨åŠŸèƒ½åˆ†ç»„

::: v-pre

```markdown
# æŒ‰ç±»åˆ«åˆ†ç±»çš„æœåŠ¡å™¨åŠŸèƒ½

## æ•°æ®å­˜å‚¨å’Œæ£€ç´¢

{{#each servers}}
{{#if (or (contains name "db") (contains name "storage") (contains name "file"))}}
{{#if hasInstructions}}

### {{name}}

{{instructions}}
{{/if}}
{{/if}}
{{/each}}

## é€šä¿¡å’Œç½‘ç»œ

{{#each servers}}
{{#if (or (contains name "web") (contains name "api") (contains name "http"))}}
{{#if hasInstructions}}

### {{name}}

{{instructions}}
{{/if}}
{{/if}}
{{/each}}

## å¤„ç†å’Œè®¡ç®—

{{#each servers}}
{{#unless (or (contains name "db") (contains name "storage") (contains name "file") (contains name "web") (contains name "api") (contains name "http"))}}
{{#if hasInstructions}}

### {{name}}

{{instructions}}
{{/if}}
{{/unless}}
{{/each}}
```

:::

## æµ‹è¯•æ‚¨çš„æ¨¡æ¿è¦†ç›–

è¦æµ‹è¯•æ‚¨çš„æ¨¡æ¿è¦†ç›–å¹¶ç¡®ä¿å®ƒä»¬æ­£å¸¸å·¥ä½œï¼š

### 1. åˆ›å»ºæµ‹è¯•æ¨¡æ¿

åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¨¡æ¿æ¥éªŒè¯æ‚¨çš„è¦†ç›–é€»è¾‘ï¼š

::: v-pre

```markdown
# æ¨¡æ¿æµ‹è¯•

{{#if hasServers}}
å‘ç° {{serverCount}} ä¸ªå¸¦æœ‰æŒ‡ä»¤çš„æœåŠ¡å™¨ã€‚

{{#each servers}}
æœåŠ¡å™¨ï¼š{{name}}ï¼ˆæœ‰æŒ‡ä»¤ï¼š{{hasInstructions}}ï¼‰
{{#if hasInstructions}}
æŒ‡ä»¤é•¿åº¦ï¼š{{instructions.length}} å­—ç¬¦
{{/if}}

{{/each}}
{{else}}
æœªæ‰¾åˆ°æœåŠ¡å™¨ã€‚
{{/if}}
```

:::

### 2. ä½¿ç”¨ CLI æµ‹è¯•

å°†æ‚¨çš„æ¨¡æ¿ä¿å­˜åˆ°æ–‡ä»¶å¹¶æµ‹è¯•ï¼š

```bash
# åˆ›å»ºæµ‹è¯•æ¨¡æ¿
echo "{{#each servers}}{{name}}: {{hasInstructions}}{{/each}}" > test-template.md

# ä½¿ç”¨æ‚¨çš„æ¨¡æ¿æµ‹è¯•
1mcp serve --instructions-template test-template.md

# è¿æ¥å®¢æˆ·ç«¯æŸ¥çœ‹æ¸²æŸ“è¾“å‡º
```

### 3. éªŒè¯æ­¥éª¤

1. **è¯­æ³•æ£€æŸ¥**ï¼šç¡®ä¿ Handlebars è¯­æ³•æœ‰æ•ˆ
2. **é€»è¾‘éªŒè¯**ï¼šä½¿ç”¨ä¸åŒçš„æœåŠ¡å™¨é…ç½®æµ‹è¯•æ¡ä»¶é€»è¾‘
3. **è¾¹ç¼˜æƒ…å†µ**ï¼šæµ‹è¯•æ— æœåŠ¡å™¨ã€å•ä¸ªæœåŠ¡å™¨ã€æ²¡æœ‰æŒ‡ä»¤çš„æœåŠ¡å™¨
4. **æ€§èƒ½**ï¼šç›‘æ§å¤šä¸ªæœåŠ¡å™¨æ—¶çš„æ¸²æŸ“æ—¶é—´

### 4. å¸¸è§æµ‹è¯•åœºæ™¯

é’ˆå¯¹è¿™äº›å¸¸è§åœºæ™¯æµ‹è¯•æ‚¨çš„æ¨¡æ¿ï¼š

- **æ— æœåŠ¡å™¨è¿æ¥**ï¼šæ¨¡æ¿åº”ä¼˜é›…åœ°å¤„ç†ç©ºçŠ¶æ€
- **æ··åˆæœåŠ¡å™¨ç±»å‹**ï¼šä¸€äº›æœ‰æŒ‡ä»¤ï¼Œä¸€äº›æ²¡æœ‰
- **é•¿æŒ‡ä»¤**ï¼šç¡®ä¿æ ¼å¼ä¿æŒå¯è¯»
- **ç‰¹æ®Šå­—ç¬¦**ï¼šæµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æœåŠ¡å™¨åç§°
- **å¤šç§ç¯å¢ƒ**ï¼šæµ‹è¯• dev/staging/prod æœåŠ¡å™¨å‘½åæ¨¡å¼

## æœåŠ¡å™¨æŒ‡ä»¤è¦†ç›–æŠ€å·§

1. **æµ‹è¯•æ‚¨çš„é€»è¾‘**ï¼šå…ˆä½¿ç”¨ç®€å•æ¡ä»¶ï¼Œç„¶åæ„å»ºå¤æ‚æ€§
2. **ä¿ç•™åŸå§‹å†…å®¹**ï¼šè€ƒè™‘ä¿æŒåŸå§‹æŒ‡ä»¤å¯ç”¨å¹¶è¿›è¡Œä¿®æ”¹
3. **ä½¿ç”¨æ³¨é‡Š**ï¼šHandlebars æ³¨é‡Š <span v-pre>`{{! comment }}`</span> æœ‰åŠ©äºè®°å½•æ‚¨çš„é€»è¾‘
4. **éªŒè¯æœåŠ¡å™¨åç§°**ï¼šæ£€æŸ¥æœåŠ¡å™¨åç§°æ˜¯å¦ç¬¦åˆæ‚¨æœŸæœ›çš„æ¨¡å¼
5. **å¤„ç†è¾¹ç¼˜æƒ…å†µ**ï¼šè€ƒè™‘æ²¡æœ‰æŒ‡ä»¤æˆ–æ„å¤–åç§°çš„æœåŠ¡å™¨
6. **æ€§èƒ½**ï¼šæ¨¡æ¿ä¸­çš„å¤æ‚é€»è¾‘åœ¨æœåŠ¡å™¨æ•°é‡å¤šæ—¶å¯èƒ½å‡æ…¢æ¸²æŸ“é€Ÿåº¦
7. **æ–‡æ¡£**ï¼šä¸ºå›¢é˜Ÿæˆå‘˜è®°å½•æ‚¨çš„è¦†ç›–é€»è¾‘
8. **ç‰ˆæœ¬æ§åˆ¶**ï¼šå°†æ¨¡æ¿ä¿å­˜åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­ä»¥è·Ÿè¸ªæ›´æ”¹

## æ¨¡æ¿é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

1. **æ¨¡æ¿æœªåŠ è½½**ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™
2. **è¯­æ³•é”™è¯¯**ï¼šä½¿ç”¨éªŒè¯å™¨éªŒè¯ Handlebars è¯­æ³•
3. **é€»è¾‘ä¸å·¥ä½œ**ï¼šé€æ­¥æµ‹è¯•å„ä¸ªæ¡ä»¶
4. **æ€§èƒ½é—®é¢˜**ï¼šç®€åŒ–å¤æ‚çš„åµŒå¥—å¾ªç¯
5. **è¾“å‡ºæ ¼å¼**ï¼šæ£€æŸ¥é¢å¤–çš„ç©ºç™½æˆ–ç¼ºå°‘çš„æ¢è¡Œç¬¦

### è°ƒè¯•æ¨¡æ¿å˜é‡

ä½¿ç”¨æ­¤è°ƒè¯•æ¨¡æ¿æ£€æŸ¥å¯ç”¨å˜é‡ï¼š

::: v-pre

```markdown
# è°ƒè¯•æ¨¡æ¿

## å¯ç”¨å˜é‡

- serverCount: {{serverCount}}
- hasServers: {{hasServers}}
- serverList: {{serverList}}
- toolPattern: {{toolPattern}}
- title: {{title}}

## æœåŠ¡å™¨è¯¦æƒ…

{{#each servers}}

### æœåŠ¡å™¨ {{@index}}ï¼š{{name}}

- æœ‰æŒ‡ä»¤ï¼š{{hasInstructions}}
- æŒ‡ä»¤é•¿åº¦ï¼š{{instructions.length}}
  {{#if hasInstructions}}
- å‰ 100 ä¸ªå­—ç¬¦ï¼š{{substring instructions 0 100}}...
  {{/if}}

{{/each}}
```

:::

æ­¤æ¨¡æ¿å°†å¸®åŠ©æ‚¨äº†è§£å“ªäº›æ•°æ®å¯ç”¨ä»¥åŠå®ƒä»¬çš„ç»“æ„ã€‚
